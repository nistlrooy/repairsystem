<?php

namespace App\RepairBundle\Entity;

use Doctrine\ORM\EntityRepository;


/**
 * RepairFormRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class RepairFormRepository extends EntityRepository
{
    public function getRepairFormByCreater($createrId,$conditionId)
    {
        $query = $this->getEntityManager()->createQuery(
            'SELECT r FROM RepairBundle:RepairForm r
            JOIN r.repairTask t
            JOIN r.formCondition c
            JOIN t.user u
            WHERE u.id = :createrId AND c.id = :conditionId'
        )->setParameters(array('createrId'=>$createrId,'conditionId'=>$conditionId));
        try
        {
            return $query->getResult();
        }catch (\Doctrine\ORM\NoResultException $e){
            return null;
        }

    }

    public function getRepairFormByReceiver($receiverId,$conditionId)
    {
        $query = $this->getEntityManager()->createQuery(
            'SELECT r From RepairBundle:RepairForm r
            JOIN r.formCondition c
            JOIN r.receive u
            WHERE u.id = :receiverId AND c.id = :conditionId'
        )->setParameters(array('receiverId'=>$receiverId,'conditionId'=>$conditionId));
        try{
            return $query->getResult();
        }catch (\Doctrine\ORM\NoResultException $e){
            return null;
        }
    }

    public function getRepairFormByNotReceived()
    {

        $query = $this->getEntityManager()->createQuery(
            'SELECT r FROM RepairBundle:RepairForm r
            WHERE r.receive is NULL '
        );
        try{
            return $query->getResult();
        }catch (\Doctrine\ORM\NoResultException $e){
            return null;
        }
    }

}
